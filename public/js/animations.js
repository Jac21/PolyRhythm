function angleBetween(n,t){var e=t.x-n.x,i=t.y-t.y;return Math.atan2(i,e)}var audienceShape=function(n,t){return function(){function e(){r.visible=!0,o=!1,g.stop(),p.stop()}var i=_.identity,o=!1,a=n;console.log(a);var r;switch(n=n||"star"){case"sqaure":r=two.makeRectangle(center.x,center.y,50,50);break;case"circle":r=two.makeCircle(center.x,center.y,25);break;case"triangle":r=two.makePolygon(center.x,center.y,25,3);break;case"star":r=two.makeStar(center.x,center.y,25,40,5)}middleGround.add(r);var s=t;r.fill=convertHex(s,50),r.stroke=convertHex(s,100),r.linewidth=5,r.visible=!0,r.rotation=Math.PI*Math.random()*10,r.scale=1;var c=Math.PI*Math.random()*10;console.log("Angle ",c);var l=Math.cos(c),u=Math.sin(c);console.log(l,u),l*=width,u*=width,l+=center.x,u+=center.y;var d=function(n,t){o=!0,r.visible=!0,g.start(),_.isFunction(n)&&(i=n)};d.onComplete=e;var h={x:l,y:u},g=new TWEEN.Tween(r.translation).to(h,4*duration).easing(Easing.Exponential.Out).onComplete(function(){p.start(),two.remove(r)}),p=new TWEEN.Tween(r).to({scale:0},1*duration).easing(Easing.Exponential.In).onComplete(function(){d.onComplete(),i()});e();var f={start:d,clear:e,playing:function(){return o}};return f}()},centerCircle=function(){function n(){l.scale=a,u.scale=r,s.visible=!0,e=!1,d.stop(),h.stop()}var t=_.identity,e=!1,i=.5,o=.5,a=i+o,r=i,s=two.makeCircle(center.x,center.y,200,200);s.fill="#FFF",s.noStroke(),s.visible=!0,s.scale=i;var c=function(n,c){console.log("Acceleration is ",acceleration);var l=acceleration/40*1.5;console.log("x is ",l),l>2&&(l=2),i>l&&(l=i),l>r?(a=l+o,r=l):r>l&&(a=a,r=l),console.log("x is ",l),console.log("pulseIn is ",a),console.log("pulseOut is ",r),e=!0,s.visible=!0,d.start(),_.isFunction(n)&&(t=n)};c.onComplete=n;var l={scale:a},u={scale:r},d=new TWEEN.Tween(s).to(l,.04*duration).easing(Easing.Exponential.Out).onComplete(function(){h.start()}),h=new TWEEN.Tween(s).to(u,.04*duration).easing(Easing.Exponential.In).onComplete(function(){c.onComplete(),t()});n();var g={start:c,clear:n,playing:function(){return e}};return g}(),veil=function(){function n(){a.visible=!1,e=!1,i=Math.random()>.5,i?(a.translation.set(center.x,-center.y),u.y=1.5*height):(a.translation.set(center.x,1.5*height),u.y=-center.y),l.y=center.y,d.stop(),h.stop()}var t=_.identity,e=!1,i=!0,o=[new Two.Anchor(-center.x,-center.y),new Two.Anchor(center.x,-center.y),new Two.Anchor(center.x,center.y),new Two.Anchor(-center.x,center.y)],a=two.makePolygon(o);a.fill="#EEE",a.noStroke();var r=function(n,i){e=!0,a.visible=!0,d.start(),!i&&g.sound&&g.sound.stop().play(),_.isFunction(n)&&(t=n)};r.onComplete=n;var s=function(){a.fill="#EEE"},c=function(){o[0].set(-center.x,-center.y),o[1].set(center.x,-center.y),o[2].set(center.x,center.y),o[3].set(-center.x,center.y)},l={y:center.y},u={y:0},d=new TWEEN.Tween(a.translation).to(l,.5*duration).easing(Easing.Exponential.Out).onComplete(function(){h.start()}),h=new TWEEN.Tween(a.translation).to(u,.5*duration).easing(Easing.Exponential.In).onComplete(function(){r.onComplete(),t()});n();var g={start:r,update:s,resize:c,clear:n,playing:function(){return e},hash:"1,1",filename:"veil"};return g}(),ufo=function(){function n(){o.visible=!1;var n=Math.random()>.5,t=Math.random()>.5;n?o.translation.x=.75*width:o.translation.x=.25*width,t?o.origin=o.translation.y=-center.y:o.origin=o.translation.y=1.5*height,o.destination.y=center.y,o.scale=1,c.stop(),l.stop()}var t=!1,e=_.identity,i=.25*min_dimension,o=two.makeCircle(0,0,i);o.noStroke().fill="#6ECCFA";var a=function(n,i){t=!0,c.start(),o.visible=!0,!i&&u.sound&&u.sound.stop().play(),_.isFunction(n)&&(e=n)};a.onComplete=n;var r=function(){o.fill="#6ECCFA"},s=function(){i=.25*min_dimension};o.destination={y:center.y};var c=new TWEEN.Tween(o.translation).to(o.destination,duration/2).easing(Easing.Circular.Out).onComplete(function(){l.start()}),l=new TWEEN.Tween(o).to({scale:0},duration/2).easing(Easing.Circular.Out).onComplete(function(){t=!1,a.onComplete(),e()});n();var u={resize:s,update:r,clear:n,start:a,playing:function(){return t},hash:"1,2",filename:"ufo"};return u}(),dotted_spiral=function(){function n(){_.each(s,m),l.rotation=Math.random()*TWO_PI,l.scale=1,w.to({rotation:l.rotation+Math.PI/8,scale:2*Math.random()+10},2*duration).stop(),t=!1}var t=!1,e=_.identity,i=120,o=min_dimension/i,a=4,r=min_dimension/2,s=_.map(_.range(i),function(n){var t=n/i,e=r*t,s=t*Math.PI*a,c=e*Math.cos(s),l=e*Math.sin(s);t=(n+.25)/i,e=r*t,s=t*Math.PI*a;var u=e*Math.cos(s),d=e*Math.sin(s),h=two.makeLine(c,l,u,d);return h.stroke=currentPallette[rand(0,currentPallette.length)],h.linewidth=(1-Math.sqrt(1-t))*o,h.cap=h.join="round",h}),c=function(n,t){var e=t/i;n.linewidth=Math.sqrt(1-e)*o};s.reverse();var l=two.makeGroup(s);l.translation.set(center.x,center.y);var u=function(n,t){w.start(),!t&&v.sound&&v.sound.stop().play(),_.isFunction(n)&&(e=n)};u.onComplete=n;var d,h,g,p=function(){l.stroke=currentPallette[rand(0,currentPallette.length)]},f=function(){l.translation.set(center.x,center.y),o=min_dimension/i,_.each(s,c)},w=new TWEEN.Tween(l).onStart(function(){t=!0}).easing(Easing.Circular.In).to({rotation:Math.PI/8,scale:8},2*duration).onUpdate(function(n){for(h=Math.min(map(n,0,.25,0,1),1),g=Math.floor(h*i),d=0;g>d;d++)s[d].visible=!0}).onComplete(function(){u.onComplete(),e()}),m=function(n){n.visible=!1};n();var v={start:u,update:p,clear:n,resize:f,playing:function(){return t},hash:"0,9",filename:"dotted-spiral"};return v}(),clay=function(){function n(){s.visible=!1,impact=new Two.Vector(Math.random()*width,Math.random()*height);var n,t,c=8*Math.random();for(c>7?(n=center.x,t=0):c>6?(n=0,t=0):c>5?(n=0,t=center.y):c>4?(n=0,t=height):c>3?(n=center.x,t=height):c>2?(n=width,t=height):c>1?(n=width,t=center.y):(n=width,t=0),s.translation.set(n,t),y.ending=0,o=height,u=0;i>u;u++)l=r[u],pct=u/i,w=pct*TWO_PI,l.set(o*Math.cos(w),o*Math.sin(w)),f=angleBetween(l,impact)-w,d=l.distanceTo(impact),p=10*o/Math.sqrt(d),n=p*Math.cos(f)+l.x,t=p*Math.sin(f)+l.y,a[u].set(n,t);e=!1,E.stop()}var t=_.identity,e=!1,i=8*Math.floor(Math.random())+8,o=(width*Math.random(),height*Math.random(),height),a=(Math.PI/2,[]),r=_.map(_.range(i),function(n){var t=n/i,e=TWO_PI*t,r=o*Math.sin(e),s=o*Math.cos(e);return a.push(new Two.Vector(r,s)),new Two.Anchor(r,s)}),s=two.makeCurve(r);s.fill=currentPallette[1],s.noStroke(),r=s.vertices;var c=function(n,e){s.visible=!0,E.start(),!e&&C.sound&&C.sound.stop().play(),_.isFunction(n)&&(t=n)};c.onComplete=n;var l,u,d,h,g,p,f,w,m=function(){s.fill=currentPallette[1]},v=function(){},y={ending:0},E=new TWEEN.Tween(y).to({ending:1},.75*duration).easing(Easing.Circular.In).onStart(function(){e=!0}).onUpdate(function(){var n=y.ending;for(u=0;i>u;u++)l=r[u],d=a[u],h=lerp(l.x,d.x,n),g=lerp(l.y,d.y,n),l.set(h,g)}).onComplete(function(){c.onComplete(),t()});n();var C={start:c,update:m,clear:n,resize:v,playing:function(){return e},hash:"0,1",filename:"clay"};return C}(),strike=function(){function n(){t=!1,r=Math.random(),i.linewidth=Math.round(5*r)+7,o.linewidth=Math.round(5*r)+7,i.translation.set(-width+width/2,i.translation.y),o.translation.set(width+width/2,o.translation.y),i.ending=i.beginning=0,i.ending=1,i.visible=!0,o.visible=!0,s.stop(),l.stop()}var t=!1,e=_.identity,i=(.5*min_dimension,two.makeLine(-width,center.y-.25*center.y,0,center.y-.25*center.y)),o=two.makeLine(width,center.y+.25*center.y,2*width,center.y+.25*center.y);i.noFill().stroke="#333",i.visible=!0,o.noFill().stroke="#333",o.visible=!0;var a=function(n,o){i.visible=!0,t=!0,s.start(),c.start(),_.isFunction(n)&&(e=n)};a.onComplete=n;var r,s=new TWEEN.Tween(i.translation).to({x:2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){a.onComplete(),e()}),c=new TWEEN.Tween(o.translation).to({x:-2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){a.onComplete(),e()}),l=new TWEEN.Tween(i).to({beginning:1},.25*duration).easing(Easing.Circular.Out).onComplete(function(){a.onComplete(),e()}),u={start:a,clear:n,playing:function(){return t}};return n(),u}(),randomStroke=function(){function n(){t=!1,r=Math.random(),i.linewidth=Math.round(5*r)+7,o.linewidth=Math.round(5*r)+7,i.translation.set(-width+width/2,i.translation.y),o.translation.set(width+width/2,o.translation.y),i.ending=i.beginning=0,i.ending=1,i.visible=!0,o.visible=!0,s.stop(),l.stop()}var t=!1,e=_.identity,i=(.5*min_dimension,two.makeLine(-width,center.y-.25*center.y,0,center.y-.25*center.y)),o=two.makeLine(width,center.y+.25*center.y,2*width,center.y+.25*center.y);i.noFill().stroke="#333",i.visible=!0,o.noFill().stroke="#333",o.visible=!0;var a=function(n,o){i.visible=!0,t=!0,s.start(),c.start(),_.isFunction(n)&&(e=n)};a.onComplete=n;var r,s=new TWEEN.Tween(i.translation).to({x:2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){a.onComplete(),e()}),c=new TWEEN.Tween(o.translation).to({x:-2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){a.onComplete(),e()}),l=new TWEEN.Tween(i).to({beginning:1},.25*duration).easing(Easing.Circular.Out).onComplete(function(){a.onComplete(),e()}),u={start:a,clear:n,playing:function(){return t}};return n(),u}(),squiggle=function(){function n(){for(l.visible=!1,a=Math.round(6*Math.random())+1,s=Math.PI/2,l.rotation=Math.random()>.5?Math.PI:0,l.ending=l.beginning=0,d=0;i>d;d++)h=c[d],g=d/i,p=TWO_PI*a*g+s,f=map(g,0,1,-o/2,o/2),w=r*Math.sin(p),h.set(f,w);t=!1,y.stop(),E.stop()}var t=!1,e=_.identity,i=200,o=center.x,a=6,r=.33*height,s=.5*Math.PI,c=_.map(_.range(i),function(n){var t=n/i,e=TWO_PI*a*t+s,c=map(t,0,1,-o/2,o/2),l=r*Math.sin(e);return new Two.Anchor(c,l)}),l=two.makePolygon(c,!0);l.translation.set(center.x,center.y),l.stroke=currentPallette[1],l.linewidth=min_dimension/40,l.cap=l.join="round",l.noFill();var u=function(n,i){l.visible=!0,t=!0,y.start(),!i&&C.sound&&C.sound.stop().play(),_.isFunction(n)&&(e=n)};u.onComplete=n;var d,h,g,p,f,w,m=function(){l.stroke=currentPallette[1]},v=function(){o=center.x,r=.33*height,l.linewidth=min_dimension/40,l.translation.set(center.x,center.y)},y=new TWEEN.Tween(l).to({ending:1},duration/2).easing(Easing.Sinusoidal.Out).onComplete(function(){E.start()}),E=new TWEEN.Tween(l).to({beginning:1},duration/2).easing(Easing.Sinusoidal.In).onComplete(function(){u.onComplete(),e()});n();var C={start:u,update:m,clear:n,resize:v,playing:function(){return t},hash:"0,7",filename:"squiggle"};return C}(),pistons=function(){function n(){d.beginning=d.ending=0;var n=Math.random()>.5;for(n?(t=-s/2,e=s/2):(t=s/2,e=-s/2),i=0;r>i;i++)p=u[i],u.visible=!1,f=p.vertices,f[0].x=f[1].x=f[2].x=f[3].x=t;o=!1,v.stop(),y.stop()}var t,e,i=1,o=!1,a=_.identity,r=4*i+1,s=.75*width,c=center.y,l=two.makeGroup();l.translation.copy(center);var u=_.map(_.range(r),function(n){var t=c/r-c/(3*r),e=0,i=-c/2+(n+1)*(c/(r+1)),o=two.makeRectangle(e,i,s,t);return o.fill="#C695FA",o.noStroke(),l.add(o),o}),d={ending:0,beginning:0},h=function(n){n.visible=!0},g=function(n,t){_.each(u,h),v.start(),!t&&E.sound&&E.sound.stop().play(),_.isFunction(n)&&(a=n)};g.onComplete=n;var p,f,w=function(){for(i=0;r>i;i++)u[i].fill=currentPallette[0]},m=function(){s=.75*width,c=center.y,l.translation.copy(center)},v=new TWEEN.Tween(d).to({ending:1},.125*duration).easing(Easing.Sinusoidal.Out).onStart(function(){o=!0}).onUpdate(function(){for(i=0;r>i;i++)p=u[i],f=p.vertices,f[3].x=f[0].x=e*d.ending}).onComplete(function(){y.start()}),y=new TWEEN.Tween(d).to({beginning:1},.125*duration).easing(Easing.Sinusoidal.Out).onUpdate(function(){for(i=0;r>i;i++)p=u[i],f=p.vertices,f[1].x=f[2].x=e*d.beginning}).onComplete(function(){g.onComplete(),a()}),E={start:g,update:w,clear:n,resize:m,playing:function(){return o}};return n(),E}(),pistons=function(){function n(){d.beginning=d.ending=0;var n=Math.random()>.5;for(n?(t=-s/2,e=s/2):(t=s/2,e=-s/2),i=0;r>i;i++)p=u[i],u.visible=!1,f=p.vertices,f[0].x=f[1].x=f[2].x=f[3].x=t;o=!1,v.stop(),y.stop()}var t,e,i=1,o=!1,a=_.identity,r=4*i+1,s=.75*width,c=center.y,l=two.makeGroup();l.translation.copy(center);var u=_.map(_.range(r),function(n){var t=c/r-c/(3*r),e=0,i=-c/2+(n+1)*(c/(r+1)),o=two.makeRectangle(e,i,s,t);return o.fill="#C695FA",o.noStroke(),l.add(o),o}),d={ending:0,beginning:0},h=function(n){n.visible=!0},g=function(n,t){_.each(u,h),v.start(),!t&&E.sound&&E.sound.stop().play(),_.isFunction(n)&&(a=n)};g.onComplete=n;var p,f,w=function(){for(i=0;r>i;i++)u[i].fill=currentPallette[rand(0,currentPallette.length)]},m=function(){s=.75*width,c=center.y,l.translation.copy(center)},v=new TWEEN.Tween(d).to({ending:1},.125*duration).easing(Easing.Sinusoidal.Out).onStart(function(){o=!0}).onUpdate(function(){for(i=0;r>i;i++)p=u[i],f=p.vertices,f[3].x=f[0].x=e*d.ending}).onComplete(function(){y.start()}),y=new TWEEN.Tween(d).to({beginning:1},.125*duration).easing(Easing.Sinusoidal.Out).onUpdate(function(){for(i=0;r>i;i++)p=u[i],f=p.vertices,f[1].x=f[2].x=e*d.beginning}).onComplete(function(){g.onComplete(),a()}),E={start:g,update:w,clear:n,resize:m,playing:function(){return o}};return n(),E}();