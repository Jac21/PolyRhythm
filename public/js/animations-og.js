function map(t,n,e,i,o){return i+(o-i)*((t-n)/(e-n))}function convertHex(t,n){return t=t.replace("#",""),r=parseInt(t.substring(0,2),16),g=parseInt(t.substring(2,4),16),b=parseInt(t.substring(4,6),16),result="rgba("+r+","+g+","+b+","+n/100+")",result}function lerp(t,n,e){return(n-t)*e+t}var type=/(canvas|webgl)/.test(url.type)?url.type:"svg",two=new Two({type:Two.Types[type],fullscreen:!0}).appendTo(document.querySelector("#two")),Easing=TWEEN.Easing,width=$(window).width(),height=$(window).height(),center={x:width/2,y:height/2},min_dimension=width>height?height:width,TWO_PI=2*Math.PI,duration=1e3,shortDuration=.3*duration,mediumDuration=.75*duration,rand=function(t,n){return Math.floor(Math.random()*(n-t))+t},colors={morning:["#FFE481","#FB8C8E","#C695FA"],afternoon:["#A6F4FE","#E9547D","#DFD4B8"],night:["#DE1157","#F2A600","#1F285E"]},currentPallette=colors.afternoon;document.querySelector("body").style.backgroundImage="linear-gradient(45deg, "+currentPallette[0]+", "+currentPallette[1]+", "+currentPallette[2]+")";var midCornerPositions=[{x:width-width/3,y:height/3/2},{x:width-width/3,y:height-height/3/2},{x:width/3,y:height/3/2},{x:width/3,y:height-height/3/2},{x:width-width/3/2,y:height/3},{x:width-width/3/2,y:height-height/3},{x:width/3/2,y:height/3},{x:width/3/2,y:height-height/3}],backGround=two.makeGroup(),highRise=function(){function t(){var t={x:width/(rand(0,e)+1),y:height+height/2};o.translation.set(t.x,t.y),o.visible=!1,o.fill=currentPallette[0],i=!1,a.stop(),l.stop()}var n=_.identity,e=5,i=!1,o=two.makeRectangle(0,0,width/e*1.5,height);o.fill=currentPallette[0],o.noStroke(),o.visible=!0;var r=function(t,e){i=!0,o.visible=!0,a.start(),_.isFunction(t)&&(n=t)};r.onComplete=t;var a=new TWEEN.Tween(o.translation).to({y:center.y},shortDuration).easing(Easing.Cubic.Out).onComplete(function(){l.start()});console.log(Easing);var l=new TWEEN.Tween(o.translation).to({y:height+height/2},shortDuration).easing(Easing.Cubic.Out).onComplete(function(){r.onComplete(),n()});t();var s={start:r,clear:t,playing:function(){return i}};return s}(),flash=function(){var t,n=!1,e=_.identity,i=two.makeRectangle(center.x,center.y,width,height);i.noStroke().fill=currentPallette[0],i.visible=!1;var o=function(o,r){_.isUndefined(t)||(clearTimeout(t),t=void 0),n=!0,!r&&l.sound&&l.sound.stop().play(),t=setTimeout(function(){n=!1,e(),i.visible=!1},.25*duration),_.isFunction(o)&&(e=o)},r=function(){i.fill=currentPallette[0]},a=function(){var t=i.vertices;t[0].set(-center.x,-center.y),t[1].set(center.x,-center.y),t[2].set(center.x,center.y),t[3].set(-center.x,center.y),i.translation.copy(center)};two.bind("update",function(){n&&(i.visible=Math.random()>.5)});var l={start:o,update:r,clear:_.identity,resize:a,playing:function(){return n}};return l}(),starExplode=function(){function t(){i.rotation=Math.PI*Math.random()*10,i.visible=!0,e=!1,a.stop(),l.stop()}var n=_.identity,e=!1,i=two.makeStar(center.x,center.y,200,400,5),o=randomColor({luminosity:"light"});i.fill=convertHex(o,100),i.stroke=convertHex(o,100),i.linewidth=10,i.visible=!0,i.scale=0;var r=function(t,o){var r=randomColor({luminosity:"light"});i.fill=convertHex(r,100),i.stroke=convertHex(r,100),e=!0,i.visible=!0,a.start(),_.isFunction(t)&&(n=t)};r.onComplete=t;var a=new TWEEN.Tween(i).to({scale:1},.2*duration).easing(Easing.Exponential.Out).onComplete(function(){l.start()}),l=new TWEEN.Tween(i).to({scale:0},.2*duration).easing(Easing.Exponential.In).onComplete(function(){r.onComplete(),n()});t();var s={start:r,clear:t,playing:function(){return e}};return s}(),middleGround=two.makeGroup(),suspension=function(){function t(){for(n=Math.random()*TWO_PI,e=map(Math.random(),0,1,Math.PI/4,Math.PI/2),E.ending=0,g=0;r>g;g++)w=h[g],m=n+Math.random()*e*2-e,a=Math.random()*u,y=a*Math.cos(m),v=a*Math.sin(m),c[g].set(y,v),w.visible=!1,w.fill=randomColor(),w.translation.set(0,0);i=!1,C.stop()}var n,e,i=!1,o=_.identity,r=16,l=40*min_dimension/900,s=60*min_dimension/900,u=height,c=[],h=_.map(_.range(r),function(t){var n=Math.round(map(Math.random(),0,1,l,s)),e=two.makeCircle(0,0,n);return e.fill=colors.white,e.noStroke(),c.push(new Two.Vector),e}),d=two.makeGroup(h);d.translation.set(center.x,center.y);var g,w,p=function(t,n){for(g=0;r>g;g++)h[g].visible=!0;C.start(),!n&&b.sound&&b.sound.stop().play(),_.isFunction(t)&&(o=t)};p.onComplete=t;var m,f,y,v,E={ending:0},C=new TWEEN.Tween(E).to({ending:1},.5*duration).easing(Easing.Sinusoidal.Out).onStart(function(){i=!0}).onUpdate(function(){for(m=E.ending,g=0;r>g;g++)w=h[g],f=c[g],y=lerp(w.translation.x,f.x,m),v=lerp(w.translation.y,f.y,m),w.translation.set(y,v)}).onComplete(function(){p.onComplete(),o()});t();var b={start:p,clear:t,playing:function(){return i}};return b}(),foreGround=two.makeGroup(),circlePop=function(){function t(){var t=midCornerPositions[rand(0,midCornerPositions.length)];i.translation.set(t.x,t.y),i.visible=!1,i.fill=currentPallette[rand(0,currentPallette.length)],e=!1,r.stop(),a.stop()}var n=_.identity,e=!1,i=two.makeCircle(center.x,center.y,200,200);i.fill="#FFF",i.noStroke(),i.visible=!0;var o=function(t,o){e=!0,i.visible=!0,r.start(),_.isFunction(t)&&(n=t)};o.onComplete=t;var r=new TWEEN.Tween(i).to({scale:1},shortDuration).easing(Easing.Exponential.Out).onComplete(function(){a.start()}),a=new TWEEN.Tween(i).to({scale:0},shortDuration).easing(Easing.Exponential.Out).onComplete(function(){o.onComplete(),n()});t();var l={start:o,clear:t,playing:function(){return e}};return l}(),horizontalLines=function(){function t(){n=!1,a=Math.random(),i.linewidth=Math.round(5*a)+7,o.linewidth=Math.round(5*a)+7,i.translation.set(-width+width/2,i.translation.y),o.translation.set(width+width/2,o.translation.y),i.ending=i.beginning=0,i.ending=1,i.visible=!0,o.visible=!0,l.stop(),u.stop()}var n=!1,e=_.identity,i=two.makeLine(-width,center.y-.25*center.y,0,center.y-.25*center.y),o=two.makeLine(width,center.y+.25*center.y,2*width,center.y+.25*center.y);i.noFill().stroke="#333",i.visible=!0,o.noFill().stroke="#333",o.visible=!0;var r=function(t,o){i.visible=!0,n=!0,l.start(),s.start(),_.isFunction(t)&&(e=t)};r.onComplete=t;var a,l=new TWEEN.Tween(i.translation).to({x:2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){r.onComplete(),e()}),s=new TWEEN.Tween(o.translation).to({x:-2*width+width/2},.7*duration).easing(Easing.Circular.In).onComplete(function(){r.onComplete(),e()}),u=new TWEEN.Tween(i).to({beginning:1},.25*duration).easing(Easing.Circular.Out).onComplete(function(){r.onComplete(),e()}),c={start:r,clear:t,playing:function(){return n}};return t(),c}();